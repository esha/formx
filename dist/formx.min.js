/*! formx - v0.3.0 - 2014-08-28
* http://esha.github.io/formx/
* Copyright (c) 2014 ESHA Research; Licensed MIT, GPL */
!function(a,b){"use strict";var c=window.FORMx={},d=c.validate={type:{number:/^\-?\d*(\.\d+)?$/,email:/^[a-zA-Z0-9.!#$%&'*+-\/=?\^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,url:/^http.[^\s]+$/i},test:{required:function(a){return!d.has(a)},pattern:function(a,b){return a&&!a.match(new RegExp("^"+b+"$"))},"equal-to":function(a,b,c){return a!==c},"not-equal":function(a,b,c){return a===c},"required-if":function(a,b,c){return d.has(c)&&!d.has(a)},"required-unless":function(a,b,c){return!d.has(c)&&!d.has(a)},maxlength:function(a,b){return a.length>parseInt(b,10)},minlength:function(a,b){return a&&a.length<parseInt(b,10)},min:function(a,b){return d.parse(a)<d.parse(b)},max:function(a,b){return d.parse(a)>d.parse(b)},step:function(a,b){var c=b.indexOf("."),d=1;if(c>=0){var e=b.length-c-1;d=Math.pow(10,e)}b=Math.round(parseFloat(b)*d);var f=Math.round(a*d)%b;return!isNaN(f)&&0!==f}},classes:{required:"valueMissing",pattern:"patternMismatch","equal-to":"notEqual","not-equal":"notDifferent","required-if":"valueMissing","required-unless":"valueMissing",maxlength:"tooLong",minlength:"tooShort",min:"rangeUnderflow",max:"rangeOverflow",step:"stepMismatch"},field:"[type=number],[type=email],[type=url],[required],[pattern],[maxlength],[min],[max],[step],[equal-to],[not-equal],[required-if],[required-unless],[minlength]",toggle:function(a,b){a.classList.toggle("invalid",!b),a.setCustomValidity(b?"":"This value is not valid.")},has:function(a){return!(!a||!a.trim())},parse:function(a){return parseFloat(a)},valueOf:function(a,b){var c=b.query('[name="'+a+'"]');return c&&c.nameValue},check:function(a,b){var c=a.getAttribute("novalidate");return c?"true"===c||"novalidate"===c?!1:0===c.indexOf("!")?-1!==c.substring(1).split().indexOf(b):-1===c.split(" ").indexOf(b):!0},one:function(a,b,c){if(!d.check(a,b))return!0;var e=d.type[a.getAttribute("type")],f=a.value,g=!0;c=c||d.getForm(a),e&&(g=!f||!!f.match(e),a.classList.toggle("typeMismatch",!g));for(var h in d.test){var i=a.getAttribute(h)||a.hasAttribute(h);if(i){var j=d.classes[h],k=d.valueOf(i,c),l=d.test[h](f,k||i,k);l&&(g=!1),a.classList.toggle(j,l)}}return d.toggle(a,g),g&&(a.lastValidValue=f),g},all:function(a,c){if(!d.check(a,c))return!0;var e=!0;if(a.queryAll(d.field).each(function(b){d.one(b,c,a)||(e=!1)}),a.classList.toggle("invalid",!e),b.fire(a,e?"valid":"invalid"),!e){var f=a.query(".invalid");f&&f.focus()}return e},getForm:function(c){return b._.closest(c,"form")||a.body}};b.on("^ready",function(){a.queryAll("form").each(function(){d.all(this,"ready")}),a.queryAll("[required]").each("aria-required",!0)}),b.on("keyup submit validate",function(a,b){if(9!==a.keyCode){var c=a.target,e=!0;return b=b&&"string"==typeof b?b:a.type,c.matches(d.field)?e=d.one(c,b):("submit"===b||"validate"===b)&&(e=d.all(d.getForm(c),b)),e}}),b.on("focusout<[restrict]>",function(a){var c=a.target;if(c.matches(".invalid")){var d=c.value;return c.value=c.lastValidValue||c.getAttribute("value")||"",b.fire(c,"restricted",d),setTimeout(function(){c.focus()},0),!1}});var e=Object.keys(d.classes).map(function(a){return d.classes[a]}).filter(function(a,b,c){return c.indexOf(a)===b});a.head.append("style").textContent=".error { display: none; }\n"+e.map(function(a){return".invalid."+a+" ~ .error."+a}).join(",\n")+" { display: inline-block; }";var f=c.ajax={selector:"form[ajax]",init:function(){a.queryAll(f.selector).each(function(a){"ready"!==a.getAttribute("ajax")&&(a.setAttribute("ajax","ready"),a.addEventListener("submit",f.block))})},block:function(a){a.preventDefault()}};f.init(),a.addEventListener("DOMContentLoaded",f.init);var g=c.flex={selector:"textarea[flex]",events:"input propertychange change",adjust:function(a,b){var c=a.scrollHeight,d=a.style;c>a.offsetHeight-2?d.height=c+"px":b||(d.height="",g.adjust(a,!0));var e=a.scrollWidth;e>a.offsetWidth?d.width=e+"px":b||(d.width="",g.adjust(a,!0))}};g.events.split(" ").forEach(function(c){b.on(a.body,c+"<"+g.selector+">",function(){g.adjust(this)})});var h=c.attributes={selector:"form[attributes]",init:function(){a.queryAll(h.selector).each(function(a){h.list(a).forEach(function(b){a.setAttribute(b,a.queryName(b).nameValue)}),b.on(a,"change input propertychange",h.change)})},list:function(a){return(a.getAttribute("attributes")||"").split(",")},change:function(a){var b=a.target,c=b.name;h.list(this).indexOf(c)>=0&&this.setAttribute(c,b.nameValue)}};h.init(),a.addEventListener("DOMContentLoaded",h.init)}(document,Eventi);